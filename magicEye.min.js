const MagicEyeModels={"6E5":{bottomFixed:!0,bottomFixedValue:1,topAngleOffset:8,bottomAngleOffset:2,topCurveIntensity:16,bottomCurveIntensity:16,topCurveDirection:-1,bottomCurveDirection:-1,centerCapRadius:18,phosphorOffColor:"#1a1a1a",phosphorOnColor:"#001505",glowColor:"#55ff77",glowBlur:.3,supportColor:"#111",centerCapColor:"#222",drawFixedAsArc:!0},EM34:{topAngleOffset:3,bottomAngleOffset:8,topCurveIntensity:16,bottomCurveIntensity:.8,topCurveDirection:-1,bottomCurveDirection:-1,centerCapRadius:18,phosphorOffColor:"#1a1a1a",phosphorOnColor:"#001505",glowColor:"#55ff77",glowBlur:.3,supportColor:"#111",centerCapColor:"#222"},EM31:{topAngleOffset:8,bottomAngleOffset:8,topCurveIntensity:16,bottomCurveIntensity:16,topCurveDirection:-1,bottomCurveDirection:-1,centerCapRadius:18,phosphorOffColor:"#1a1a1a",phosphorOnColor:"#001505",glowColor:"#55ff77",glowBlur:.3,supportColor:"#111",centerCapColor:"#222"}};"undefined"!=typeof module&&module.exports&&(module.exports=MagicEyeModels);class MagicEye{constructor(t={}){if(!t.container)throw new Error("MagicEye: container is required");if(this.containerElement="string"==typeof t.container?document.querySelector(t.container):t.container,!this.containerElement)throw new Error("MagicEye: container element not found");if(this.model=t.model||"EM34",this.config=MagicEyeModels[this.model],!this.config)throw new Error(`MagicEye: unknown model "${this.model}"`);t.configOverrides&&(this.config={...this.config,...t.configOverrides}),this.size=t.size||350,this.isPowered=void 0===t.powered||t.powered,this.remanence=t.remanence||15,this.glassOverlay=t.glassOverlay||null,this.rotation=void 0!==t.rotation?t.rotation:0,this.minValue=void 0!==t.minValue?t.minValue:0,this.maxValue=void 0!==t.maxValue?t.maxValue:1,this.onPowerChange=t.onPowerChange||null,this.onSignalChange=t.onSignalChange||null,this.currentV=void 0!==t.signal?t.signal:.3,this.targetV=this.currentV,this.animationFrameId=null,this._init()}_init(){this._createDOM(),this._draw(this.currentV),this._animate(),this.isPowered&&this.containerElement.classList.add("powered-on")}_createDOM(){this.containerElement.style.setProperty("--tube-size",this.size+"px"),this.containerElement.style.width=this.size+"px",this.containerElement.style.height=this.size+"px",0!==this.rotation&&(this.containerElement.style.transform=`rotate(${this.rotation}deg)`);const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("viewBox","0 0 100 100"),t.setAttribute("id","magicEye");const e=document.createElementNS("http://www.w3.org/2000/svg","defs"),i=document.createElementNS("http://www.w3.org/2000/svg","filter");i.setAttribute("id","supportGlow"),i.setAttribute("x","-50%"),i.setAttribute("y","-50%"),i.setAttribute("width","200%"),i.setAttribute("height","200%");const n=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");n.setAttribute("in","SourceGraphic"),n.setAttribute("stdDeviation","0.8"),n.setAttribute("result","blur");const s=document.createElementNS("http://www.w3.org/2000/svg","feComposite");s.setAttribute("in","color"),s.setAttribute("in2","blur"),s.setAttribute("operator","in"),s.setAttribute("result","glow");const o=document.createElementNS("http://www.w3.org/2000/svg","feMerge"),r=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");r.setAttribute("in","glow");const a=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");a.setAttribute("in","SourceGraphic"),o.appendChild(r),o.appendChild(a),i.appendChild(n),i.appendChild(s),i.appendChild(o),e.appendChild(i),t.appendChild(e);const l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttribute("cx","50"),l.setAttribute("cy","50"),l.setAttribute("r","48"),l.classList.add("phosphor-bg"),t.appendChild(l);const h=document.createElementNS("http://www.w3.org/2000/svg","g");h.classList.add("glow-layer"),this.wingLeft=document.createElementNS("http://www.w3.org/2000/svg","path"),this.wingLeft.setAttribute("id","wingLeft"),this.wingLeft.classList.add("glow-curtain"),h.appendChild(this.wingLeft),this.wingRight=document.createElementNS("http://www.w3.org/2000/svg","path"),this.wingRight.setAttribute("id","wingRight"),this.wingRight.classList.add("glow-curtain"),h.appendChild(this.wingRight),this.fixedTopArc=document.createElementNS("http://www.w3.org/2000/svg","path"),this.fixedTopArc.setAttribute("id","fixedTopArc"),this.fixedTopArc.classList.add("glow-curtain"),h.appendChild(this.fixedTopArc),this.fixedBottomArc=document.createElementNS("http://www.w3.org/2000/svg","path"),this.fixedBottomArc.setAttribute("id","fixedBottomArc"),this.fixedBottomArc.classList.add("glow-curtain"),h.appendChild(this.fixedBottomArc),t.appendChild(h);const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d","M 48 49.8 L 48 51.5 L 0 50.65 Z"),c.classList.add("support-shadow"),c.setAttribute("filter","url(#supportGlow)"),t.appendChild(c);const d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d","M 52 49.8 L 52 51.5 L 100 50.65 Z"),d.classList.add("support-shadow"),d.setAttribute("filter","url(#supportGlow)"),t.appendChild(d);const u=document.createElementNS("http://www.w3.org/2000/svg","circle");if(u.setAttribute("cx","50"),u.setAttribute("cy","50"),u.setAttribute("r",this.config.centerCapRadius),u.classList.add("center-cap"),t.appendChild(u),this.containerElement.appendChild(t),this.glassOverlay){const t=document.createElement("img");t.src=this.glassOverlay,t.classList.add("glass-overlay"),t.alt="",this.containerElement.appendChild(t)}this._injectStyles()}_injectStyles(){if(document.getElementById("magic-eye-styles"))return;const t=document.createElement("style");t.id="magic-eye-styles",t.textContent=`\n      .tube-container {\n        position: relative;\n        width: var(--tube-size, 350px);\n        height: var(--tube-size, 350px);\n        border-radius: 50%;\n        transition: all 0.3s ease;\n      }\n\n      .phosphor-bg {\n        fill: ${this.config.phosphorOffColor};\n        transition: fill 0.8s ease;\n      }\n\n      .tube-container.powered-on .phosphor-bg {\n        fill: ${this.config.phosphorOnColor};\n      }\n\n      .glow-layer {\n        isolation: isolate;\n        opacity: 0;\n        transition: opacity 1.2s ease;\n      }\n\n      .tube-container.powered-on .glow-layer {\n        opacity: 1;\n      }\n\n      .glow-curtain {\n        fill: ${this.config.glowColor};\n        filter: blur(${this.config.glowBlur}px);\n        mix-blend-mode: plus-lighter;\n      }\n\n      .support-shadow {\n        fill: ${this.config.supportColor};\n      }\n\n      .center-cap {\n        fill: ${this.config.centerCapColor};\n        filter: blur(0.3px);\n      }\n\n      .glass-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 10;\n      }\n    `,document.head.appendChild(t)}_describeSector(t,e,i,n,s,o=!1,r=1){if(Math.abs(s-n)<.1)return"";const a=Math.PI/180,l={x:t+i*Math.cos(n*a),y:e+i*Math.sin(n*a)},h={x:t+i*Math.cos(s*a),y:e+i*Math.sin(s*a)},c=(s%360+360)%360,d=t=>{let e=Math.min(Math.abs(t-270),Math.abs(t-270+360),Math.abs(t-270-360)),i=Math.min(Math.abs(t-90),Math.abs(t-90+360),Math.abs(t-90-360));let n=0,s=-1;if(e<45){n=(1-e/45)*this.config.topCurveIntensity,s=this.config.topCurveDirection}else if(i<45){n=(1-i/45)*this.config.bottomCurveIntensity,s=this.config.bottomCurveDirection}return{intensity:n,direction:s}},u=o?-1:1,g=r,p=d((n%360+360)%360);let m=null;if(p.intensity>.01){const s=.5*i;m={x:t+s*Math.cos(n*a)+p.direction*u*p.intensity*g,y:e+s*Math.sin(n*a)}}const w=d(c);let f=null;if(w.intensity>.01){const n=.5*i;f={x:t+n*Math.cos(s*a)+w.direction*u*w.intensity*g,y:e+n*Math.sin(s*a)}}const b=Math.abs(s-n)<=180?"0":"1";let y=["M",t,e];return m?y.push("Q",m.x,m.y,l.x,l.y):y.push("L",l.x,l.y),y.push("A",i,i,0,b,1,h.x,h.y),f?y.push("Q",f.x,f.y,t,e):y.push("L",t,e),y.push("Z"),y.join(" ")}_animate(){if(this.isPowered){const t=1/this.remanence;Math.abs(this.targetV-this.currentV)>1e-4&&(this.currentV+=(this.targetV-this.currentV)*t,this._draw(this.currentV))}else this.currentV>.001&&(this.currentV*=.92,this._draw(this.currentV));this.animationFrameId=requestAnimationFrame((()=>this._animate()))}_describeFixedArc(t,e,i,n){const s=this.config.centerCapRadius;if(n){const n=t-s;return["M",n,e,"L",t-i,e,"A",i,i,0,0,1,t+i,e,"L",t+s,e,"A",s,s,0,0,0,n,e,"Z"].join(" ")}{const n=t+s;return["M",n,e,"L",t+i,e,"A",i,i,0,0,1,t-i,e,"L",t-s,e,"A",s,s,0,0,0,n,e,"Z"].join(" ")}}_clamp(t,e,i){return Math.max(e,Math.min(i,t))}_normalizeValue(t){const e=this._clamp(t,0,1);return this.minValue+e*(this.maxValue-this.minValue)}_draw(t){const e=this._normalizeValue(t),i=1-e;if(this.config.drawFixedAsArc&&(this.config.topFixed||this.config.bottomFixed)){if(this.config.topFixed){this.fixedTopArc.setAttribute("d",this._describeFixedArc(50,50,49.8,!0)),this.fixedBottomArc.setAttribute("d","");const t=e*(90+this.config.bottomAngleOffset);this.wingLeft.setAttribute("d",this._describeSector(50,50,49.8,180,180+t,!0,i)),this.wingRight.setAttribute("d",this._describeSector(50,50,49.8,-t,0,!1,i))}else if(this.config.bottomFixed){this.fixedBottomArc.setAttribute("d",this._describeFixedArc(50,50,49.8,!1)),this.fixedTopArc.setAttribute("d","");const t=e*(90+this.config.topAngleOffset);this.wingLeft.setAttribute("d",this._describeSector(50,50,49.8,180,180+t,!0,i)),this.wingRight.setAttribute("d",this._describeSector(50,50,49.8,-t,0,!1,i))}}else{const t=(this.config.topFixed?this.config.topFixedValue:e)*(90+this.config.topAngleOffset),n=(this.config.bottomFixed?this.config.bottomFixedValue:e)*(90+this.config.bottomAngleOffset);this.fixedTopArc.setAttribute("d",""),this.fixedBottomArc.setAttribute("d",""),this.wingLeft.setAttribute("d",this._describeSector(50,50,49.8,180-t,180+n,!0,i)),this.wingRight.setAttribute("d",this._describeSector(50,50,49.8,-n,t,!1,i))}}setSignal(t){"number"!=typeof t||t<0||t>1?console.warn("MagicEye.setSignal: value must be between 0 and 1"):(this.targetV=t,this.onSignalChange&&this.onSignalChange(t))}getSignal(){return this.targetV}setPower(t){this.isPowered=!!t,this.isPowered?this.containerElement.classList.add("powered-on"):(this.containerElement.classList.remove("powered-on"),this.targetV=0),this.onPowerChange&&this.onPowerChange(this.isPowered)}isPoweredOn(){return this.isPowered}toggle(){this.setPower(!this.isPowered)}setRemanence(t){"number"!=typeof t||t<1||t>50?console.warn("MagicEye.setRemanence: value must be between 1 and 50"):this.remanence=t}setSize(t){"number"!=typeof t||t<50?console.warn("MagicEye.setSize: invalid size"):(this.size=t,this.containerElement.style.setProperty("--tube-size",t+"px"),this.containerElement.style.width=t+"px",this.containerElement.style.height=t+"px")}setRotation(t){"number"==typeof t?(this.rotation=t,this.containerElement.style.transform=`rotate(${t}deg)`):console.warn("MagicEye.setRotation: invalid rotation value")}setMinValue(t){"number"!=typeof t||t<0||t>1?console.warn("MagicEye.setMinValue: value must be between 0 and 1"):t>=this.maxValue?console.warn("MagicEye.setMinValue: minValue must be less than maxValue"):this.minValue=t}setMaxValue(t){"number"!=typeof t||t<0||t>1?console.warn("MagicEye.setMaxValue: value must be between 0 and 1"):t<=this.minValue?console.warn("MagicEye.setMaxValue: maxValue must be greater than minValue"):this.maxValue=t}setGlassOverlay(t){const e=this.containerElement.querySelector(".glass-overlay");if(e&&e.remove(),this.glassOverlay=t,t){const e=document.createElement("img");e.src=t,e.classList.add("glass-overlay"),e.alt="",this.containerElement.appendChild(e)}}destroy(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.containerElement.innerHTML="",this.wingLeft=null,this.wingRight=null,this.fixedTopArc=null,this.fixedBottomArc=null,this.containerElement=null}}"undefined"!=typeof module&&module.exports&&(module.exports=MagicEye);